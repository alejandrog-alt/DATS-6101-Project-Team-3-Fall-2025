---
title: "DATS 6101-11 Introduction to Data Science: First Project"
author: "Team 3 : Alejandro, Ebrima, Vidyullatha"
date: "`r Sys.Date()`"
output:
  html_document:
    theme: "cerulean"
    highlight: tango
    code_folding: hide
    toc_depth: 3
    toc_float: yes
    toc: yes
    number_sections: true
    df_print: paged
---

```{r init, include=F}
# Frequently used functions are loadPkg(), xkabledply(), xkablesummary(), uzscale(), etc.
library(devtools)
library(ezids)
library(dplyr)
library(tidyverse)
```


```{r setup, include=FALSE}
# Some of common RMD options (and the defaults) are: 
# include=T, eval=T, echo=T, results='hide'/'asis'/'markup',..., collapse=F, warning=T, message=T, error=T, cache=T, fig.width=6, fig.height=4, fig.dim=c(6,4) #inches, fig.align='left'/'center','right', 
knitr::opts_chunk$set(results="markup", warning = F, message = F)
# Can globally set option for number display format.
options(scientific=T, digits = 3) 
# options(scipen=9, digits = 3) 
```

# Summary of the dataset 

Load the dataset into R
```{r}
library(readr)
studperf <- read_csv("./data/StudentsPerformance.csv")
```

Display the first 5 records
```{r}
head(studperf, 5)
```

Structure of dataset (variable types)
```{r}
str(studperf)
```

Basic summary statistics
```{r}
summary(studperf)
```

Variance, mean, and standard deviation for each column
```{r, echo=TRUE}
study_hours_var  <- var(studperf$weekly_self_study_hours, na.rm = T)
study_hours_mean <- mean(studperf$weekly_self_study_hours , na.rm = T)
study_hours_sd   <- sd(studperf$weekly_self_study_hours, na.rm = T)

attendance_var   <- var(studperf$attendance_percentage, na.rm = T)
attendance_mean  <- mean(studperf$attendance_percentage , na.rm = T)
attendance_sd   <- sd(studperf$attendance_percentage, na.rm = T)

participation_var  <- var(studperf$class_participation, na.rm = T)
participation_mean <- mean(studperf$class_participation , na.rm = T)
participation_sd   <- sd(studperf$class_participation, na.rm = T)

total_score_var  <- var(studperf$total_score, na.rm = T)
total_score_mean <- mean(studperf$total_score, na.rm = T)
total_score_sd   <- sd(studperf$total_score, na.rm = T)

```

**Study Hours: **
- Variance: `r study_hours_var`;
- Mean: `r study_hours_mean`; 
- Stabdard Deviation: `r study_hours_sd`

**Attendance: **
- Variance: `r attendance_var`; 
- Mean: `r attendance_mean`; 
- Stabdard Deviation: `r attendance_sd`

**Participation: **
- Variance: `r participation_var`; 
- Mean: `r participation_mean`; 
- Stabdard Deviation: `r participation_sd`

**Total Score: **
- Variance: `r total_score_var`; 
- Mean: `r total_score_mean`; 
- Stabdard Deviation: `r total_score_sd`


Column names
```{r}
names(studperf)
```

Unique values
```{r}
sapply(studperf, function(x) length(unique(x)))
```

# Descriptive statistics

**How many observations are in this data set?**
```{r, echo=TRUE}
#length(studperf)
#nrow(studperf)
dim(studperf)
```

**Answer:** The number of observations in this data set is `r nrow(studperf)`.

**How many observations having missing (NA) values?**
```{r}
sum(is.na(studperf$weekly_self_study_hours))
sum(is.na(studperf$attendance_percentage))
sum(is.na(studperf$class_participation))
sum(is.na(studperf$total_score))
```

**Answer:** There are no missing values.

Converting `grade` to a factor variable
```{r, echo=TRUE}
studperf$grade <- factor(studperf$grade, levels = c("F","D","C","B","A"), ordered = TRUE)
summary(studperf)
```

Looking at new summary statistics nicely: Using the ezids package
```{r, echo=TRUE}
studperf_summary <- studperf
colnames(studperf_summary)[1:6]=c("Student ID","Weekly Study Hours","Attendance Percentage","Class Participation","Total Score","Grade")
xkablesummary(studperf_summary)
```

# Graphical representations of the data

Including Plots
```{r echo=TRUE}

library(ggplot2)

# Downsample for plotting if huge
plot_studperf <- studperf %>% sample_n(min(5000, nrow(studperf)))

ggplot(data=plot_studperf, aes(x=weekly_self_study_hours) ) + 
geom_histogram(  col="white", 
                 fill="red", 
                 alpha = .8, # opacity
                 bins = 60) + 
  labs(
        x="Weekly Self Study Hours", 
        y="Frequency",
        title="Histogram of Weekly Self Study Hours in Student Performance Dataset") 


ggplot( data=plot_studperf, aes(x=attendance_percentage) ) + 
geom_histogram(  col="white", 
                 fill="blue", 
                 alpha = .8, # opacity
                 bins = 60) + 
  labs(
        x="Attendance Percentage", 
        y="Frequency",
        title="Histogram of Attendance Percentage in Student Performance Dataset")

ggplot( data=plot_studperf, aes(x=class_participation) ) + 
geom_histogram(  col="white", 
                 fill="orange", 
                 alpha = .8, # opacity
                 bins = 60) + 
  labs(
        x="Class Participation", 
        y="Frequency",
        title="Histogram of Class Participation in Student Performance Dataset") 

ggplot( data=plot_studperf, aes(x=total_score) ) + 
geom_histogram(  col="white", 
                 fill="green", 
                 alpha = .8, # opacity
                 bins = 60) + 
  labs(
        x="Total Score", 
        y="Frequency",
        title="Histogram of Total Score in Student Performance Dataset") 

ggplot(plot_studperf, aes(x=grade)) + 
  geom_bar( col="white", 
                 fill="purple", 
                 alpha = .8) + 
  labs(
        x="Grade", 
        y="Frequency",
        title="Barplot of Grade in Student Performance Dataset") 
```

Removing outliers
```{r echo=TRUE}

studperfclean = outlierKD2(studperf, weekly_self_study_hours, rm = TRUE, boxplt = TRUE, qqplt = TRUE)
studperfclean2 = outlierKD2(studperfclean, attendance_percentage, rm = TRUE, boxplt = TRUE, qqplt = TRUE)
studperfclean3 = outlierKD2(studperfclean2, class_participation, rm = TRUE, boxplt = TRUE, qqplt = TRUE)
studperfclean4 = outlierKD2(studperfclean3, total_score, rm = TRUE, boxplt = TRUE, qqplt = TRUE)
```

# Answering the SMART QUESTIONS: 

### Q1: Do students with attendance ≥ 85% achieve higher average total scores than those with attendance < 85%?

```{r}
high_attend <- subset(studperf, attendance_percentage >= 85)
low_attend  <- subset(studperf, attendance_percentage < 85)
```

Calculate averages for attendance percentatge >= 85 and attendance percentatge < 85
```{r}
high_mean <- mean(high_attend$total_score)
high_mean <- mean(low_attend$total_score)
```

T-test to check significance
```{r}
t.test(total_score ~ attendance_percentage >= 85, data = studperf)
```

**Answer:** The students with attendance ≥ 85% have an average total score of `r mean(high_attend$total_score)` compared to `r mean(low_attend$total_score)` for students with attendance < 85%.


### Q2: Is there a linear relationship between the number of weekly self-study hours and a student’s total_score?

Correlation
```{r}
correlation <- cor(studperf$weekly_self_study_hours, studperf$total_score, use = "complete.obs")
```

Simple linear regression
```{r}
model <- lm(total_score ~ weekly_self_study_hours, data = studperf)
slope <- coef(model)[2]
p_value <- summary(model)$coefficients[2, 4]
```

Plot
```{r}
ggplot(studperf, aes(x = weekly_self_study_hours, y = total_score)) +
  geom_point(alpha = 0.6) +
  geom_smooth(method = "lm", color = "blue") +
  labs(
    title = "Relationship between Study Hours and Total Score",
    x = "Weekly Self-Study Hours",
    y = "Total Score"
  )
```


**Answer:** The correlation coefficient between weekly self-study hours and total score is `r round(correlation, 3)`, suggesting a `r ifelse(correlation > 0, "positive", "negative")` linear relationship.
From the regression model, the slope coefficient is `r round(slope, 3)` with a p-value of `r signif(p_value, 3)`.
This indicates that for each additional hour of self-study per week, the total score increases by approximately `r round(slope, 2)` points.
Given that the p-value is `r ifelse(p_value < 0.05, "less than 0.05", "greater than 0.05")`, the relationship is `r ifelse(p_value < 0.05, "statistically significant", "not statistically significant")`.
Therefore, there `r ifelse(p_value < 0.05, "is", "is no")` evidence of a meaningful linear relationship between weekly self-study hours and total scores.

### Q4 : What are the average weekly study hours, attendance percentage, class participation, and total scores for all students in the dataset?

Checking the dataframe again:
```{r}
studperf_summary <- studperfclean4
colnames(studperf_summary)[1:6]=c("Student ID","Weekly Study Hours","Attendance Percentage","Class Participation","Total Score","Grade")
xkablesummary(studperf_summary)
```

Note: The outliers were replaced by NAs. They were not deleted from the df. 

```{r}
sum(is.na(studperfclean4$weekly_self_study_hours))
sum(is.na(studperfclean4$attendance_percentage))
sum(is.na(studperfclean4$class_participation))
sum(is.na(studperfclean4$total_score))
```

Removing NaN
```{r}
studperfclean4 <- drop_na(studperfclean4,
                    weekly_self_study_hours,
                    attendance_percentage,
                    class_participation,
                    total_score)

sum(is.na(studperfclean4$weekly_self_study_hours))
sum(is.na(studperfclean4$attendance_percentage))
sum(is.na(studperfclean4$class_participation))
sum(is.na(studperfclean4$total_score))
```


A Scatterplot between Weekly Self Study Hours and Class Participation, with points colored by Grade
```{r echo=TRUE}

ggplot(studperfclean4, aes(x =weekly_self_study_hours , y = class_participation, color = grade)) +
  geom_point(size = 3, alpha = 0.7) +
  labs(
    title = "Scatterplot of Weekly Self Study Hours and Class Participation Colored by Grade",
    x = "Weekly Self Study Hours",
    y = "Class Participation",
    color = "Grade"
  ) +
  theme_minimal()
```


### Q3: Are there any students who dedicate very few hours to studying but still achieve a higher  total_score?

```{r echo=TRUE}

# cutoffs
low_hours  <- quantile(studperfclean4$weekly_self_study_hours, 0.20, na.rm=TRUE)
high_score <- quantile(studperfclean4$total_score, 0.90, na.rm=TRUE)

# pick the students
few_but_high <- subset(studperfclean4,
  weekly_self_study_hours <= low_hours & total_score >= high_score)

nrow(few_but_high); head(few_but_high)

```

### Q5: Do students with unusually high total_score despite low study hours, attendance, and participation show significant anomalies?

Low-effort and high scorers

```{r echo=TRUE}

# low-effort = bottom 20% on all three
q <- with(studperfclean4, data.frame(
  study = quantile(weekly_self_study_hours, 0.20, na.rm=TRUE),
  att   = quantile(attendance_percentage,   0.20, na.rm=TRUE),
  part  = quantile(class_participation,     0.20, na.rm=TRUE)
))

# Using subset
low <- subset(studperfclean4,
  weekly_self_study_hours <= q$study &
  attendance_percentage   <= q$att   &
  class_participation     <= q$part)

# Unusually High = top ~2.3% within LOW group (≈ Z > 2 equivalent)
cut97 <- quantile(low$total_score, 0.977, na.rm=TRUE)
low$anomaly <- low$total_score > cut97

c(n_low = nrow(low),
  cutoff = cut97,
  observed = sum(low$anomaly),
  rate = mean(low$anomaly) )
```





