---
title: "DATS 6101-11 Introduction to Data Science: First Project"
author: "Team 3 : Alejandro, Ebrima, Vidyullatha"
date: "`r Sys.Date()`"
output:
  html_document:
    theme: "cerulean"
    highlight: tango
    code_folding: hide
    toc_depth: 3
    toc_float: yes
    toc: yes
    number_sections: true
    df_print: paged
---

```{r init, include=F}
# Frequently used functions are loadPkg(), xkabledply(), xkablesummary(), uzscale(), etc.
library(devtools)
library(ezids)
library(dplyr)
library(tidyverse)
```


```{r setup, include=FALSE}
# Some of common RMD options (and the defaults) are: 
# include=T, eval=T, echo=T, results='hide'/'asis'/'markup',..., collapse=F, warning=T, message=T, error=T, cache=T, fig.width=6, fig.height=4, fig.dim=c(6,4) #inches, fig.align='left'/'center','right', 
knitr::opts_chunk$set(results="markup", warning = F, message = F)
# Can globally set option for number display format.
options(scientific=T, digits = 3) 
# options(scipen=9, digits = 3) 
```

# 1. Summary of the dataset 

**Load the dataset into R**
```{r}
library(readr)
studperf <- read_csv("StudentsPerformance.csv")
```

**Display the first 5 records**
```{r}
head(studperf, 5)
```

**Structure of dataset (variable types)**
```{r}
str(studperf)
```

**Basic summary statistics**
```{r}
summary(studperf)
```
**Variance, mean, and sd for each column**

```{r, echo=TRUE}
study_hours_var  <- var(studperf$weekly_self_study_hours, na.rm = T)
study_hours_mean <- mean(studperf$weekly_self_study_hours , na.rm = T)
study_hours_sd   <- sd(studperf$weekly_self_study_hours, na.rm = T)

attendance_var   <- var(studperf$attendance_percentage, na.rm = T)
attendance_mean  <- mean(studperf$attendance_percentage , na.rm = T)
attendance_sd   <- sd(studperf$attendance_percentage, na.rm = T)

participation_var  <- var(studperf$class_participation, na.rm = T)
participation_mean <- mean(studperf$class_participation , na.rm = T)
participation_sd   <- sd(studperf$class_participation, na.rm = T)

total_score_var  <- var(studperf$total_score, na.rm = T)
total_score_mean <- mean(studperf$total_score, na.rm = T)
total_score_sd   <- sd(studperf$total_score, na.rm = T)

```
Study Hours Var: `r study_hours_var`;
Study Hours Mean: `r study_hours_mean`; 
Study Hours SD: `r study_hours_sd`

Attendance Var: `r attendance_var`; 
Attendance Mean: `r attendance_mean`; 
Attendance SD: `r attendance_sd`

Participation Var: `r participation_var`; 
Participation Mean: `r participation_mean`; 
Participation SD: `r participation_sd`

Total Score Var: `r total_score_var`; 
Total Score Mean: `r total_score_mean`; 
Total Score SD: `r total_score_sd`

**Column names and unique values**
```{r}
names(studperf)
sapply(studperf, function(x) length(unique(x)))
```


# 2. Descriptive statistics

**How many observations are in this data set?**
```{r, echo=TRUE}
#length(studperf)
#nrow(studperf)
dim(studperf)
```
**Answer:** The number of observations in this data set is `r nrow(studperf)`.

**How many observations having missing (NA) values?**
```{r}
sum(is.na(studperf$weekly_self_study_hours))
sum(is.na(studperf$attendance_percentage))
sum(is.na(studperf$class_participation))
sum(is.na(studperf$total_score))
```
**Answer:** There are no missing values.

**Converting `grade` to a factor variable**
```{r, echo=TRUE}
studperf$grade <- factor(studperf$grade, levels = c("F","D","C","B","A"), ordered = TRUE)
summary(studperf)
```

**Looking at new summary statistics nicely: Using the ezids package**

```{r, echo=TRUE}
studperf_summary <- studperf
colnames(studperf_summary)[1:6]=c("Student ID","Weekly Study Hours","Attendance Percentage","Class Participation","Total Score","Grade")
xkablesummary(studperf_summary)
```

# 3. Graphical representations of the data

**Including Plots**
```{r echo=TRUE}

library(ggplot2)

# Downsample for plotting if huge
plot_studperf <- studperf %>% sample_n(min(5000, nrow(studperf)))

ggplot(data=plot_studperf, aes(x=weekly_self_study_hours) ) + 
geom_histogram(  col="white", 
                 fill="red", 
                 alpha = .8, # opacity
                 bins = 60) + 
  labs(
        x="Weekly Self Study Hours", 
        y="Frequency",
        title="Histogram of Weekly Self Study Hours in Student Performance Dataset") 


ggplot( data=plot_studperf, aes(x=attendance_percentage) ) + 
geom_histogram(  col="white", 
                 fill="blue", 
                 alpha = .8, # opacity
                 bins = 60) + 
  labs(
        x="Attendance Percentage", 
        y="Frequency",
        title="Histogram of Attendance Percentage in Student Performance Dataset")

ggplot( data=plot_studperf, aes(x=class_participation) ) + 
geom_histogram(  col="white", 
                 fill="orange", 
                 alpha = .8, # opacity
                 bins = 60) + 
  labs(
        x="Class Participation", 
        y="Frequency",
        title="Histogram of Class Participation in Student Performance Dataset") 

ggplot( data=plot_studperf, aes(x=total_score) ) + 
geom_histogram(  col="white", 
                 fill="green", 
                 alpha = .8, # opacity
                 bins = 60) + 
  labs(
        x="Total Score", 
        y="Frequency",
        title="Histogram of Total Score in Student Performance Dataset") 

ggplot(plot_studperf, aes(x=grade)) + 
  geom_bar( col="white", 
                 fill="purple", 
                 alpha = .8) + 
  labs(
        x="Grade", 
        y="Frequency",
        title="Barplot of Grade in Student Performance Dataset") 
```

**Removing outliers**
```{r echo=TRUE}

studperfclean = outlierKD2(studperf, weekly_self_study_hours, rm = TRUE, boxplt = TRUE, qqplt = TRUE)
studperfclean2 = outlierKD2(studperfclean, attendance_percentage, rm = TRUE, boxplt = TRUE, qqplt = TRUE)
studperfclean3 = outlierKD2(studperfclean2, class_participation, rm = TRUE, boxplt = TRUE, qqplt = TRUE)
studperfclean4 = outlierKD2(studperfclean3, total_score, rm = TRUE, boxplt = TRUE, qqplt = TRUE)
```
**Q4 What are the average weekly study hours, attendance percentage, class participation, and total scores for all students in the dataset?**

Checking the dataframe again:

```{r}
studperf_summary <- studperfclean4
colnames(studperf_summary)[1:6]=c("Student ID","Weekly Study Hours","Attendance Percentage","Class Participation","Total Score","Grade")
xkablesummary(studperf_summary)
```

The outliers were replaced by NAs. They were not deleted from the df. 

```{r}
sum(is.na(studperfclean4$weekly_self_study_hours))
sum(is.na(studperfclean4$attendance_percentage))
sum(is.na(studperfclean4$class_participation))
sum(is.na(studperfclean4$total_score))
```

**Removing NaN**
```{r}

studperfclean4 <- drop_na(studperfclean4,
                    weekly_self_study_hours,
                    attendance_percentage,
                    class_participation,
                    total_score)

sum(is.na(studperfclean4$weekly_self_study_hours))
sum(is.na(studperfclean4$attendance_percentage))
sum(is.na(studperfclean4$class_participation))
sum(is.na(studperfclean4$total_score))

```


**A Scatterplot between Weekly Self Study Hours and Class Participation, with points colored by Grade **
```{r echo=TRUE}

ggplot(studperfclean4, aes(x =weekly_self_study_hours , y = class_participation, color = grade)) +
  geom_point(size = 3, alpha = 0.7) +
  labs(
    title = "Scatterplot of Weekly Self Study Hours and Class Participation Colored by Grade",
    x = "Weekly Self Study Hours",
    y = "Class Participation",
    color = "Grade"
  ) +
  theme_minimal()
```
**Q3: Are there any students who dedicate very few hours to studying but still achieve a higher  total_score? **

```{r echo=TRUE}

# cutoffs
low_hours  <- quantile(studperfclean4$weekly_self_study_hours, 0.20, na.rm=TRUE)
high_score <- quantile(studperfclean4$total_score, 0.90, na.rm=TRUE)

# pick the students
few_but_high <- subset(studperfclean4,
  weekly_self_study_hours <= low_hours & total_score >= high_score)

nrow(few_but_high); head(few_but_high)

```
**Q5 Do students with unusually high total_score despite low study hours, attendance, and participation show significant anomalies?**

Low-effort and high scorers

```{r echo=TRUE}

# low-effort = bottom 20% on all three
q <- with(studperfclean4, data.frame(
  study = quantile(weekly_self_study_hours, 0.20, na.rm=TRUE),
  att   = quantile(attendance_percentage,   0.20, na.rm=TRUE),
  part  = quantile(class_participation,     0.20, na.rm=TRUE)
))

# Using subset
low <- subset(studperfclean4,
  weekly_self_study_hours <= q$study &
  attendance_percentage   <= q$att   &
  class_participation     <= q$part)

# Unusually High = top ~2.3% within LOW group (â‰ˆ Z > 2 equivalent)
cut97 <- quantile(low$total_score, 0.977, na.rm=TRUE)
low$anomaly <- low$total_score > cut97

c(n_low = nrow(low),
  cutoff = cut97,
  observed = sum(low$anomaly),
  rate = mean(low$anomaly) )
```





