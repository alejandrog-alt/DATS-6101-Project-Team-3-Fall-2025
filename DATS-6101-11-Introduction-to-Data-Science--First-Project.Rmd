---
title: "DATS 6101-11 Introduction to Data Science: First Project"
author: "Team 3 : Alejandro, Ebrima, Vidyullatha"
date: "`r Sys.Date()`"
output:
  html_document:
    theme: "cerulean"
    highlight: tango
    code_folding: hide
    toc_depth: 3
    toc_float: yes
    toc: yes
    number_sections: true
    df_print: paged
---

```{r init, include=F}
# Frequently used functions are loadPkg(), xkabledply(), xkablesummary(), uzscale(), etc.
library(devtools)
library(ezids)
library(dplyr)
library(tidyverse) 
```


```{r setup, include=FALSE}
# Some of common RMD options (and the defaults) are: 
# include=T, eval=T, echo=T, results='hide'/'asis'/'markup',..., collapse=F, warning=T, message=T, error=T, cache=T, fig.width=6, fig.height=4, fig.dim=c(6,4) #inches, fig.align='left'/'center','right', 
knitr::opts_chunk$set(results="markup", warning = F, message = F)
# Can globally set option for number display format.
options(scientific=T, digits = 3) 
# options(scipen=9, digits = 3) 
```

The study will utilize a synthetic dataset (obtained from Kaggle) containing 1,000,000 rows and 6 columns with the variables: student_id, weekly_self_study_hours, attendance_percentage, class_participation, total_score, and grade. With all numerics, except the header row and grade column, makes the data set ideal for exploratory data analysis and deriving insights to understand the performance of each student. By quantifying the data and applying relevant statistical tools such as summary statistics, descriptive statistics, ggplot2 among others, we can better perceive the data and make sound conclusions. There is research that considers other factors of student performance such as nutrition and student performance by Taras Howard (2005); indoor air quality and student performance by the United States Environmental Protection Agency (2003); education resources and student performance by Yaniv, R and Adi, Y (2021). They are all mostly external factors that can affect the performance of a student. Our study narrows the focus down to the internal factors or what could be described as accessible by all students against their total scores.

Research Topic: Analyse the Factors that Contribute to Student Performance

*SMART Questions of the Research* 
1.	Do students with attendance ≥ 85% achieve higher average total scores than those with attendance < 85%?
2.	Is there a linear relationship between the number of weekly self-study hours and a student’s total_score?
3.	Are there any students who dedicate very few hours to studying but still achieve a higher  total_score?
4.	What are the average weekly study hours, attendance percentage,class  participation and total scores for all students in the dataset?
5.	Do students with unusually high total_score despite low study hours, attendance, and participation show significant anomalies?

*Summary of the dataset* 

Load the data set into R.

```{r}
library(readr)
studperf <- read_csv("./data/StudentsPerformance.csv")
```

Display the first 5 rows
```{r}
head(studperf, 5)
```

Structure of dataset (variable types)
```{r}
str(studperf)
```

Basic summary statistics
```{r}
summary(studperf)
```

Variance, mean, and standard deviation for each column
```{r, echo=TRUE}
study_hours_var  <- var(studperf$weekly_self_study_hours, na.rm = T)
study_hours_mean <- mean(studperf$weekly_self_study_hours , na.rm = T)
study_hours_sd   <- sd(studperf$weekly_self_study_hours, na.rm = T)

attendance_var   <- var(studperf$attendance_percentage, na.rm = T)
attendance_mean  <- mean(studperf$attendance_percentage , na.rm = T)
attendance_sd   <- sd(studperf$attendance_percentage, na.rm = T)

participation_var  <- var(studperf$class_participation, na.rm = T)
participation_mean <- mean(studperf$class_participation , na.rm = T)
participation_sd   <- sd(studperf$class_participation, na.rm = T)

total_score_var  <- var(studperf$total_score, na.rm = T)
total_score_mean <- mean(studperf$total_score, na.rm = T)
total_score_sd   <- sd(studperf$total_score, na.rm = T)

```

**Study Hours: **
- Variance: `r study_hours_var`;
- Mean: `r study_hours_mean`; 
- Standard Deviation: `r study_hours_sd`

**Attendance: **
- Variance: `r attendance_var`; 
- Mean: `r attendance_mean`; 
- Standard Deviation: `r attendance_sd`

**Participation: **
- Variance: `r participation_var`; 
- Mean: `r participation_mean`; 
- Standard Deviation: `r participation_sd`

**Total Score: **
- Variance: `r total_score_var`; 
- Mean: `r total_score_mean`; 
- Standard Deviation: `r total_score_sd`


Column names
```{r}
names(studperf)
```

Unique values
```{r}
sapply(studperf, function(x) length(unique(x)))
```

Descriptive statistics

**How many observations are in this data set?**
```{r, echo=TRUE}
#length(studperf)
#nrow(studperf)
dim(studperf)
```

**Answer:** The number of observations in this data set is `r nrow(studperf)`.

**How many observations having missing (NA) values?**
```{r}
sum(is.na(studperf$weekly_self_study_hours))
sum(is.na(studperf$attendance_percentage))
sum(is.na(studperf$class_participation))
sum(is.na(studperf$total_score))
```

**Answer:** There are no missing values.

Converting `grade` to a factor variable
```{r, echo=TRUE}
studperf$grade <- factor(studperf$grade, levels = c("F","D","C","B","A"), ordered = TRUE)
summary(studperf)
```

Looking at new summary statistics nicely: Using the ezids package
```{r, echo=TRUE}
studperf_summary <- studperf
colnames(studperf_summary)[1:6]=c("Student ID","Weekly Study Hours","Attendance Percentage","Class Participation","Total Score","Grade")
xkablesummary(studperf_summary)
```

**Findings:**
#There are no missing values in the data set
#Most of the values fall within the 3rd quartile 
#Under the Grade column, category A contains more values than any of the other four categories

# Graphical representations of the data

Including Plots
```{r echo=TRUE}

library(ggplot2)

# Downsample for plotting if huge
plot_studperf <- studperf %>% sample_n(min(5000, nrow(studperf)))

ggplot(data=plot_studperf, aes(x=weekly_self_study_hours) ) + 
geom_histogram(  col="white", 
                 fill="red", 
                 alpha = .8, # opacity
                 bins = 60) + 
  labs(
        x="Weekly Self Study Hours", 
        y="Frequency",
        title="Histogram of Weekly Self Study Hours in Student Performance Dataset") 


ggplot( data=plot_studperf, aes(x=attendance_percentage) ) + 
geom_histogram(  col="white", 
                 fill="blue", 
                 alpha = .8, # opacity
                 bins = 60) + 
  labs(
        x="Attendance Percentage", 
        y="Frequency",
        title="Histogram of Attendance Percentage in Student Performance Dataset")

ggplot( data=plot_studperf, aes(x=class_participation) ) + 
geom_histogram(  col="white", 
                 fill="orange", 
                 alpha = .8, # opacity
                 bins = 60) + 
  labs(
        x="Class Participation", 
        y="Frequency",
        title="Histogram of Class Participation in Student Performance Dataset") 

ggplot( data=plot_studperf, aes(x=total_score) ) + 
geom_histogram(  col="white", 
                 fill="green", 
                 alpha = .8, # opacity
                 bins = 60) + 
  labs(
        x="Total Score", 
        y="Frequency",
        title="Histogram of Total Score in Student Performance Dataset") 

ggplot(plot_studperf, aes(x=grade)) + 
  geom_bar( col="white", 
                 fill="purple", 
                 alpha = .8) + 
  labs(
        x="Grade", 
        y="Frequency",
        title="Barplot of Grade in Student Performance Dataset") 
```

*Outlier Check for the variables: weekly study hours, attendance, class participation and total score respectively. We use the ezids package*

```{r echo=TRUE}

studperfclean = outlierKD2(studperf, weekly_self_study_hours, rm = TRUE, boxplt = TRUE, qqplt = TRUE)
studperfclean2 = outlierKD2(studperfclean, attendance_percentage, rm = TRUE, boxplt = TRUE, qqplt = TRUE)
studperfclean3 = outlierKD2(studperfclean2, class_participation, rm = TRUE, boxplt = TRUE, qqplt = TRUE)
studperfclean4 = outlierKD2(studperfclean3, total_score, rm = TRUE, boxplt = TRUE, qqplt = TRUE)
```
Note: The outliers were replaced by NAs. They were not deleted from the df. 

```{r}
sum(is.na(studperfclean4$weekly_self_study_hours))
sum(is.na(studperfclean4$attendance_percentage))
sum(is.na(studperfclean4$class_participation))
sum(is.na(studperfclean4$total_score))
```

Removing NaN
```{r}
studperfclean4 <- drop_na(studperfclean4,
                    weekly_self_study_hours,
                    attendance_percentage,
                    class_participation,
                    total_score)

sum(is.na(studperfclean4$weekly_self_study_hours))
sum(is.na(studperfclean4$attendance_percentage))
sum(is.na(studperfclean4$class_participation))
sum(is.na(studperfclean4$total_score))
```

Checking the dataframe again:
```{r}
studperf_summary <- studperfclean4
colnames(studperf_summary)[1:6]=c("Student ID","Weekly Study Hours","Attendance Percentage","Class Participation","Total Score","Grade")
xkablesummary(studperf_summary)
```

# Answering the SMART questions: 

### Q1: Do students with attendance ≥ 85% achieve higher average total scores than those with attendance < 85%?

Creating a categorical variable for attendance
```{r}
studperfclean4$attendance_group <- ifelse(studperfclean4$attendance_percentage >= 85, 
                                   "High (≥85%)", "Low (<85%)")
```

Checking the counts of each group
```{r}
table(studperfclean4$attendance_group)
```

Calculating average total scores for high attendance group 
```{r}
high_mean <- mean(subset(studperfclean4, attendance_group == "High (≥85%)")$total_score)
high_mean
```

Calculating average total scores for low attendace group 
```{r}
low_mean  <- mean(subset(studperfclean4, attendance_group == "Low (<85%)")$total_score)
low_mean
```

Running t-test to examine the significance and see if this observed difference could have happened just by random chance
```{r}
t_test_result <- t.test(total_score ~ attendance_group, data = studperfclean4)
t_test_result
```

**Answer:** Students with attendance ≥ 85% have an average total score of `r high_mean`, while students with attendance < 85% have an average of `r low_mean`. The t-test p-value is `r round(t_test_result$p.value, 3)`, which indicates that the difference is `r ifelse(t_test_result$p.value < 0.05, "statistically significant", "not statistically significant")`. Therefore, students with higher attendance do `r ifelse(t_test_result$p.value < 0.05, "", "not")` necessarily achieve higher total scores in this dataset

### Q2: Is there a linear relationship between the number of weekly self-study hours and a student’s total_score?

Calculating the correlation between weekly self study hours vs total score
```{r}
correlation <- cor(studperfclean4$weekly_self_study_hours, studperfclean4$total_score, use = "complete.obs")
correlation
```

Plot
```{r}
plot_data <- studperfclean4 %>% sample_n(min(5000, nrow(studperfclean4)))
ggplot(plot_data, aes(x = weekly_self_study_hours, y = total_score)) +
  geom_point(color = "blue", alpha = 0.6) +
  geom_smooth(method = "loess", se = FALSE, color = "red") +
  labs(
    title = "Relationship between Weekly Self-Study Hours and Total Score",
    x = "Weekly Self-Study Hours",
    y = "Total Score"
  ) +
  theme_minimal()
```

**Answer:**  The correlation coefficient between weekly self-study hours and total score is `r round(correlation, 3)`. This value suggests a `r ifelse(correlation > 0, "positive", "negative")` relationship, meaning that as weekly self-study hours increase, total scores tend to `r ifelse(correlation > 0, "increase", "decrease")`.  

The scatter plot further supports this trend, showing that students who spend more time studying generally achieve higher total scores.  
However, correlation does **not imply causation**, and while there appears to be a linear pattern, other factors may also influence performance.

### Q3: Are there any students who dedicate very few hours to studying but still achieve a higher  total_score?

```{r echo=TRUE}

# cutoffs
low_hours  <- quantile(studperfclean4$weekly_self_study_hours, 0.20, na.rm=TRUE)
high_score <- quantile(studperfclean4$total_score, 0.90, na.rm=TRUE)

# pick the students
few_but_high <- subset(studperfclean4,
  weekly_self_study_hours <= low_hours & total_score >= high_score)

nrow(few_but_high); head(few_but_high)

```

**Answer:** Yes `r nrow(few_but_high)` is > 0, so there are students who study very little (≤ 20th percentile of hours) and still score very high (≥ 90th percentile).

### Q4 : What are the average weekly study hours, attendance percentage, class participation, and total scores for all students in the dataset?

Average for each column
```{r, echo=TRUE}

study_hours_mean <- mean(studperfclean4$weekly_self_study_hours , na.rm = T)
attendance_mean  <- mean(studperfclean4$attendance_percentage , na.rm = T)
participation_mean <- mean(studperfclean4$class_participation , na.rm = T)
total_score_mean <- mean(studperfclean4$total_score, na.rm = T)

```

**Answer:** Average of Weekly Study Hours, Attendance Percentage, Class Participation, and Total Scores are `r study_hours_mean`, `r attendance_mean`, `r participation_mean`, `r total_score_mean` respectively.

### Q5: Do students with unusually high total_score despite low study hours, attendance, and participation show significant anomalies?

```{r echo=TRUE}

# low-effort = bottom 20% on all three
q <- with(studperfclean4, data.frame(
  study = quantile(weekly_self_study_hours, 0.20, na.rm=TRUE),
  att   = quantile(attendance_percentage,   0.20, na.rm=TRUE),
  part  = quantile(class_participation,     0.20, na.rm=TRUE)
))

# Using subset
low <- subset(studperfclean4,
  weekly_self_study_hours <= q$study &
  attendance_percentage   <= q$att   &
  class_participation     <= q$part)

# Unusually High = top ~2.3% within LOW group (≈ Z > 2 equivalent)
cut97 <- quantile(low$total_score, 0.977, na.rm=TRUE)
low$anomaly <- low$total_score > cut97

n_low   <- nrow(low)
cutoff  <- as.numeric(cut97)
observed<- sum(low$anomaly)
rate    <- mean(low$anomaly) * 100

```

Low-effort and high scorers

We defined low effort as the bottom 20% on study hours, attendance, and participation, and flagged "unusually high" total_score as above the 97.7th percentile within that low-effort group.

**Answer:** Yes, there are `r nrow(low) ` students who scored unusually high even though they belong to the lowest 20% in study hours, attendance, and participation.

Total low-effort students: `r n_low`
High-score cutoff (97.7th pct): `r round(cutoff, 1)`
Anomalies found: `r observed` students
Rate: `r sprintf('%.2f%%', rate)`

This small percentage shows these students are rare outliers, not a common pattern.

# Reflections and Limitations

The analysis provides several insights into student performance. We observed a strong positive correlation (r = 0.815) between weekly self-study hours and total scores, indicating that students who dedicate more time to self-study tend to achieve higher scores. The identification of low-effort yet high-performing students highlights that there are exceptional cases, suggesting that factors beyond study hours, attendance, and participation may influence performance, such as prior knowledge or learning strategies.

**Limitations of the dataset and analysis:**

- The dataset is cross-sectional; therefore, causality cannot be inferred from correlations or t-tests. 
- Outlier removal was necessary to stabilize the analysis; however, this may slightly bias averages or variability.
- Certain variables, such as `grade`, are categorical summaries of continuous performance and may hide subtle variations.
- The dataset lacks information on student demographics, prior academic performance, or socioeconomic status, which could influence outcomes.
- Statistical tests assume approximate normality of distributions; although the dataset is large, non-normality in some variables could affect small-effect comparisons.

**Future improvements:**

- Collect longitudinal data to better understand causality between study behaviors and performance.
- Include additional explanatory variables (e.g., study environment, prior grades) to improve predictive insights.
- Explore advanced modeling techniques such as multiple regression or mixed-effects models to account for multiple influencing factors simultaneously.

This reflection helps contextualize the analysis, acknowledges potential biases, and suggests directions for further research.

**References:**  

- Taras, H. (2005), Nutrition and Student Performance at School. Journal of School Health, 75: 199-213. https://doi.org/10.1111/j.1746-1561.2005.tb06674.x
- United States Environmental Protection Agency (2003). Indoor Environmental Division. Indoor Air Quality & Student Performance.  Washington, D.C: U.S.
- Yaniv, R. and Shany, A. (2021), “Education Resources and Student Performance: Evidence from Arab Municipalities in Israel.” Applied economics 53.38): 4386–4403. 
- Nabeel, G.M (n.d). Student Performance Dataset (Synthetic, Realistic). Kaggle 

  